# Session

* 서버가 client에 유일하고 암호화 된 ID를 부여
* 중요 데이터는 서버에서 관리
* 쿠키에는 암호화 된 상태로 부여
* 상대적으로 보안에 취약한 쿠키에 sessionID를 담아줘야 한다
* 쿠키는 경우에 따라 스크립트 태그를 통해 자바스크립트로 접근이 가능하여, sessionID는 암호화를 하는 과정이 필요하다
* set-Cookie 메소드를 통해서 전달해준다
* 세션 아이디가 부여가 되어있다면, sessionID로 서버에게 요청
* db에 sessionID를 확인하고, 업데이트 해줌
## session 단점
* 서버 메모리에 저장된다
* 만약에 서버에 이용자가 많은 경우, 메모리 같은 일정 공간에 항상 차지함으로, 가용메모리양이 줄어들어, 서버의 성능이 안좋아진다
* 또한, 기존 쿠키를 대체하지못해, XSS 공격에 취약하여, 개인정보가 털릴 수 있다
* 유저 인증 정보는 더이상 쿠키에 담기지 않고 각각의 세션 객체에 저장되어 로그인 이후 각각의 세션 객체에 해당 유저의 인증정보를 저장하는 로직이 필요
* 이렇게 유저 인증정보를 저장하고 나면, 서버는 매 요청마다 해당되는 세션 객체에 저장된 유저 인증정보를 바탕으로 유저정보 요청같은 인증이 필요한 요청이 이전에 인증된 유저의 요청인지 검증 가능
* 그렇다고 해서 쿠키는 더이상 사용되지 않는건 아니고, 쿠키에는 인증정보 대신 세션 아이디를 저장
* 만약 쿠키를 통해서 유효한 세션 아이디가 서버에 전달되고, 세션 객체에 해당 세션 아이디에 유저의 인증정보가 존재한다면 서버는 해당 요청이 유저정보에 접근 가능하다고 판단
* 하지만 쿠키에 세션 아이디 정보가 없거나 해당 세션 객체에 유저 인증정보가 존재하지 않는경우, 서버는 해당 요청이 유저정보에 접근하게 두어서는 안된다
* 또한 서버는 로그아웃 요청을 반드시 필요
* 세션 아이디가 담긴 쿠키는 인터넷 탭을 닫으면 삭제
* 하지만 유효기간이 따로 정해져 있지 않아서 세션 아이디 쿠키가 유출된 상태에서는 해당 쿠키를 이용한 요청이 유출된 쿠키를 이용한 공격인지, 정말로 사용자가 요청을 보낸건지 서버는 확인할 방법이 없으며, 서버는 쿠키의 유출 여부조차 알수 없습니다. 즉 서버에서 세션을 파괴하는 과정이 반드시 필요
## express-session
* 이런 세션을 대신 관리해주는 ‘express-session’ 이라는 모듈이 존재
* ‘express-session’은 세션을 위한 미들웨어로, ‘Express’에서 세션을 다룰 수 있는 공간을 보다 쉽게 만들어 준다
* 또한 필요한 경우 세션 아이디를 쿠키에 저장하고, 해당 세션 아이디에 종속되는 고유한 세션 객체를 서버 메모리에 저장합니다. 이때 세션 객체는 서로 독립적인 객체이므로 각각 다른 데이터를 저장
* req.session이 바로 세션 객체이며 req.session은 세션 객체에 세션 데이터를 저장거나 불러오기 위해 사용