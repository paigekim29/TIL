#Promise, async, await

#Promise
- a JavaScript object for asynchronous operation
###State
- pending (while operation) â€” > fulfilled or rejected
###Producer vs Consumer
####Producer
- when new Promise is created, the executor runs automatically!
####Consumers: then, catch, finally
```js
// Producer
const promise = new Promise((resolve, reject) => {
  // doing some heavy work (network, read files)
  console.log('doing sth...');
  setTimeout(() => {
    resolve('paige'); // ì˜ ì„±ê³µí–ˆìœ¼ë©´ resolveë¼ëŠ” ì½œë°±ì—ë‹¤ê°€ ì „ë‹¬ 
    reject(new Error('no network')) // Error-javascript object
  }, 2000);
});

// executor: (resolve, reject) 
// resolve : ê¸°ëŠ¥ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•´ì„œ ë§ˆì§€ë§‰ì— dataë¥¼ ì „ë‹¬í•  callback í•¨ìˆ˜ 
// reject: ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ë‹¤ê°€ ì¤‘ê°„ì— ë¬¸ì œê°€ ìƒê¸°ë©´ í˜¸ì¶œí•  callback í•¨ìˆ˜ 

// Consumers
// promiseê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ resolveì— ì „ë‹¬ ëœ ê°’ì´ thenì˜ parameterë¡œ ë“¤ì–´ê°€ê²Œ ë¨ 
promise
  .then(value => {
    console.log(value); //'paige'ê°€ ë“¤ì–´ì˜¤ê²Œ ë¨
  })
  .catch(error => {
    console.log(error);
  })
// catchê°€ ì—†ìœ¼ë©´ Uncaught syntax error ë¼ê³  ëœ¸
// ë§Œì•½ ì‹¤íŒ¨ë¥¼ í•˜ë©´ catchë¡œ ì²˜ë¦¬ 
// thenì„ í˜¸ì¶œí•˜ë©´, promiseë¥¼ ë¦¬í„´í•˜ê¸° ë•Œë¬¸ì—, ê·¸ ë¦¬í„´ ëœ promiseì˜ catchë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŒ   
  .finally(() => {
    console.log('finally')
  });
// ì„±ê³µê³¼ ì‹¤íŒ¨ ì—†ì´ í•­ìƒ í˜¸ì¶œ ë¨ 
```
###Promise Chaining
- promise chainëŠ” ê°™ì€ ê°ì²´ë¥¼ ë¦¬í„´í•˜ì§€ ì•Šê³  í•­ìƒ ë‹¤ë¥¸ promiseë¥¼ ë¦¬í„´í•˜ê²Œ ë¨
```js
const fetchNumber = new Promise((resolve, reject) => {
  setTimeout(() => resolve(1), 1000) // +1sec
});

//thenì€ ê°’ì„ ë°”ë¡œ ì „ë‹¬í•´ë„ ë˜ê³  ë˜ëŠ” promise ì „ë‹¬ ê°€ëŠ¥

fetchNumber 
  .then(num => num * 2) // 2
  .then(num => num * 3) // 6
  .then(num => {
    return new Promise((resolve, rejcet) => {
      setTimeout(() => resolve(num - 1), 1000); // 5
    });
  })
  .then(num => console.log(num)); // 2ì´ˆ ë’¤ 5ê°€ ëœ¸, +1 sec
  // thenì—ì„œ ë°›ì•„ì˜¤ëŠ” ê°’ì´ í•˜ë‚˜ì´ê³  ë°”ë¡œ ì „ë‹¬í•˜ëŠ” ê±°ë©´ ìƒëµ ê°€ëŠ¥
  //(console.log)
```
###Error Handling
- then(onFulfilled, onRejected) ë‘ê°œì˜ parametersë¥¼ ë„˜ê¸¸ ìˆ˜ ìˆìŒ
- onFulfilled = thenì—ì„œ ì„±ê³µí–ˆì„ ë•Œ ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜
- onRejected = thenì—ì„œ ì˜ˆì™¸ì²˜ë¦¬í•´ ì¤„ ìˆ˜ ìˆëŠ” í•¨ìˆ˜

```js
function wait(sec){
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      reject('error!');
    }, sec * 1000);
  });
}

---
// try {
//   wait(3);
// }catch(e) {
//   console.error(e)
// }
// ì´ë ‡ê²Œ ì²˜ë¦¬í•´ì£¼ë©´ uncaught(in promise)ì´ ì¡íˆì§€ ì•ŠìŒ ì˜ˆì™¸ë¥¼ ë°œìƒí•˜ëŠ” íƒ€ì´ë°ì´
// tryê°€ ì‹¸ê³  ìˆëŠ” ì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ” íƒ€ì´ë°ì´ ì•„ë‹ˆë¼, ë‚˜ì¤‘ì— ì½œìŠ¤íƒìœ¼ë¡œ ì½œìŠ¤íƒì´ ë¹„ì–´ìˆì„ ë•Œ, 
// ë‚˜ì¤‘ì— íƒ€ì´ë¨¸ê°€ íì— ë„£ê³  ê·¸ íì˜ ë‚´ìš©ì´ ì½œìŠ¤íƒì´ ìŒ“ì˜€ê¸° ë•Œë¬¸ì—, promiseì˜ catchë¥¼ ì´ìš©í•´ì•¼ ë¨

---
wait(3)
  .catch(e => {
    console.log('1st catch', e)
    // throw e ë¥¼ í•˜ê²Œ ë˜ë©´ ë’¤ì— catchì˜ consoleì´ ì°í˜
  }) // ì²«ë²ˆì¨° catchëŠ” promiseì˜ executerì˜ ì‹¤í–‰ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ì£¼ëŠ” ì•  
  .catch(e => {
    console.log('1st catch', e)
  }) // ìœ— catch ìì²´ì˜ í–‰ë™ì´ ì‹¤í–‰ ëëŠ”ì§€ì— í•´ë‹¹í•˜ëŠ” promiseì— ê±¸ì–´ë‘” catch 
// ê·¸ë ‡ê¸° ë–„ë¬¸ì— ë‘ë²ˆì§¸ catchì˜ consoleì€ ì°íˆì§€ ì•ŠëŠ”ë‹¤

---
wait(3)
  .then(
    () => {
      console.log('done!!!');
    },
    e => {
      console.log('1st catch in Then', e);
    }
  )
  .catch(e => {
    console.log('2nd catch', e);
  });
// 1st catch in Then error! 
// ë‘ë²ˆì§¸ catchëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŒ 

---
wait(3)
  .then(
    () => {
      console.log('done!!!'); // ì„±ê³µí–ˆì„ ë•Œ onfulfilled
    },
    e => {
      console.log('1st catch in Then', e); // onrejected 
      throw new Error('throw in Then')
    }
  )
  .catch(e => {
    console.log('2nd catch', e);
  });
// 1st catch in Then error! 
// 2nd catch Error: throw in Then
```

```js
const getHen = () =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve('ğŸ“'), 1000);
  })
  
const getEgg = hen => 
  new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${hen} => ğŸ¥š`), 1000);
  })
  
const cook = egg =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => ğŸ³`), 1000);
  })
  

getHen() 
  .then(hen => getEgg(hen)) //(getEgg)
  .then(egg => cook(egg)) //(cook)
  .then(meal => console.log(meal)); //(console.log) 3ì´ˆ ë’¤ì— ğŸ“ => ğŸ¥š => ğŸ³ 
// ì½œë°±í•¨ìˆ˜ë¥¼ ì „ë‹¬í•  ë•Œ, ë°›ì•„ì˜¤ëŠ” valueë¥¼ ë°”ë¡œ ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œ ì „ë‹¬í•  ë•Œ ìƒëµ ê°€ëŠ¥

---
const getHen = () =>
    new Promise((resolve, reject) => {
      setTimeout(() => resolve('ğŸ“'), 1000);
    })

const getEgg = hen =>
    new Promise((resolve, reject) => {
      setTimeout(() => reject(new Error(`error! ${hen} => ğŸ¥š`), 1000))
    })

const cook = egg =>
    new Promise((resolve, reject) => {
      setTimeout(() => resolve(`${egg} => ğŸ³`), 1000)
    })

getHen() 
  .then(getEgg) 
  .then(cook) 
  .then(console.log)
  .catch(console.log); 
  // ë§Œì•½ì— ì—†ìœ¼ë©° Uncaught(in promise)Error: error! ğŸ“ => ğŸ¥š ë¼ê³  ëœ¨ì§€ë§Œ
  // catch ë¥¼ ì‚¬ìš©í•˜ë©´ Error: error! ğŸ“ => ğŸ¥š 
  
---
getHen() 
  .then(getEgg) // ë°”ë¡œ catchë¡œ ì‹¤íŒ¨ë¥¼ í–ˆì„ ë•Œ ì²˜ë¦¬ë¥¼ í•´ì£¼ë©´ ëê¹Œì§€ ê³„ì† ì§„í–‰ì´ ë¨ 
  .catch(error => {
    return 'ğŸ¥¯'
  })
  .then(cook)
  .then(console.log) 
  .catch(console.log); //ğŸ¥¯ => ğŸ³
```

```js
const sleep = (wait) => {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve('hello')
    }, wait);
  });
}

function runPromise() {
  resetTitle();
  playVideo();

  sleep(1000).then((param) => {
    console.log(param);
    pauseVideo();
    displayTitle();
    return 'world'
  })
      .then((param) => {
        console.log(param);
        sleep(500);
      })
      .then(highlightTitle)
      .then(sleep.bind(null, 2000)) 
      .then(resetTitle)
      .then(resetTitle)
      .catch(err => {
        console.log(err);
      })
}
// resolve()ë¥¼ ë‹¤ë¥¸ í•¨ìˆ˜ì˜ ì½œë°±ìœ¼ë¡œ ë„˜ê²¨ì¤˜ì•¼ í•˜ëŠ”ë°(setTimeout ë“±) 
// ì´ë•Œ ë°ì´í„°ë„ í•¨ê»˜ ë„˜ê²¨ì¤˜ì•¼ í•œë‹¤ë©´, ìµëª… í•¨ìˆ˜ë¡œ ê°ì‹¸ì£¼ê±°ë‚˜ bind()ë¥¼ ì‚¬ìš©
```

###async & await
- clear style of using promise
-promiseë¥¼ ìœ„ì— ë” ê°„í¸í•œ APIë¥¼ ì œê³µí•˜ëŠ” ê²ƒ => Syntactic Sugar
####async
- í‚¤ì›Œë“œë¥¼ ì“°ë©´ ë°”ë¡œ í•¨ìˆ˜ì•ì— ì“°ë©´ ì½”ë“œ ë¸”ëŸ­ì´ promiseê°€ ë˜ì–´ë²„ë¦¼
- async í•¨ìˆ˜ì˜ ë¦¬í„´ì€ promiseì˜ resolveì™€ ë™ì¼í•˜ë‹¤ê³  í•  ìˆ˜ ìˆìŒ
```js
function fetchUser() {
  return new Promise((resolve, reject) => {
    resolve('paige') // Resolveë‚˜ rejectê°€ ì—†ìœ¼ë©´ ìƒíƒœëŠ” í•­ìƒ Promise {<pending>}
  })
}

const user = fetchUser();
user.then(console.log) // paige
console.log(user); // Promise {<fulfilled>: "paige"}

async function fetchUser() {
    return 'paige'
}

const user = fetchUser();
user.then(console.log) // paige
console.log(user); // Promise {<fulfilled>: "paige"}
```

```js
function gotoCodestates() {
  return new Promise((resolve, reject) => {
    setTimeout(() => { resolve('1. go to codestates') },
        Math.floor(Math.random() * 100) + 1)
  })
}

function sitAndCode() {
    return new Promise((resolve, reject) => {
        setTimeout(() => { resolve('2. sit and code') }, 
        Math.floor(Math.random() * 100) + 1)
    })
}
 
function eatLunch() {
    return new Promise((resolve, reject) => {
        setTimeout(() => { resolve('3. eat lunch') }, 
        Math.floor(Math.random() * 100) + 1)
    })
}
 
function goToBed() {
    return new Promise((resolve, reject) => {
        setTimeout(() => { resolve('4. goToBed') }, Math.floor(Math.random() * 100) + 1)
    })
}
 
const result = async () => {
    const one = await gotoCodestates();
    console.log(one)
 
    const two = await sitAndCode();
    console.log(two)
 
    const three = await eatLunch();
    console.log(three)
 
    const four = await goToBed();
    console.log(four)
}
 
result();
```
####await
- async í•¨ìˆ˜ ì•ˆì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥
- promiseë¥¼ ê¸°ë‹¬ë¦´ ìˆ˜ ìˆëŠ” ì•„ì´(fulfilledë‚˜ rejected ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì¤Œ)

```js
function delay(ms){
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function getApple(){
  await delay(3000);
  return 'ğŸ'; // 3ì´ˆ ìˆë‹¤ê°€ ğŸ ë¦¬í„´
}

async function getBanana(){
  await delay(3000);
  return 'ğŸŒ'; // 3ì´ˆ ìˆë‹¤ê°€ ğŸŒ ë¦¬í„´
}

function pickFruits(){
  return getApple().then(apple => {
    return getBanana().then(banana => `${apple} + ${banana}`);
  });
}

pickFruits().then(console.log)// 6ì´ˆ í›„ì— ğŸ + ğŸŒ => callback hell
---
async function pickFruits(){
  const apple = await getApple() // 3ì´ˆ í›„ì— ğŸ
  const banana = await getBanana() // 3ì´ˆ í›„ì— ğŸŒ
  return `${apple} + ${banana}`;
}
pickFruits().then(console.log) // 6ì´ˆ í›„ì— ğŸ + ğŸŒ 

---
async function getApple(){
  await delay(3000);
  throw 'error'
  return 'ğŸ'; 
}

async function pickFruits(){
  try { // Try ì•ˆì—ëŠ” ì˜ˆì™¸ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì½”ë“œ
    const apple = await getApple() // 3ì´ˆ í›„ì— ğŸ
    const banana = await getBanana() // 3ì´ˆ í›„ì— ğŸŒ
  } catch(e){ // try ì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì—ëŠ” catchë¡œ ë„˜ì–´ì™€ì„œ ì²˜ë¦¬ 
    console.log(e)
  }
  return `${apple} + ${banana}`;
}
// ì—ëŸ¬ ì²˜ë¦¬

---
// ì´ë ‡ê²Œ ì“¸ ìˆ˜ë„ ìˆì§€ë§Œ í•˜ì§€ ì•Šê³  ë°‘ì— ìˆëŠ” API ë°©ë²• ì‚¬ìš©í•¨
async function pickFruits(){
  const applePromise = getApple()  // promiseë¥¼ ë§Œë“¤ë©´ ë°”ë¡œ promiseì•ˆì— ìˆëŠ” ì½”ë“œë¸”ëŸ­ ì‹¤í–‰
  const bananaPromise = getBanana()
  const apple = await getApple()
  const banana = await getBanana()
  return `${apple} + ${banana}`;  // ë³‘ë ¬ì ìœ¼ë¡œ ë™ì‹œì— ì‹¤í–‰ 3ì´ˆ í›„ì— ğŸ + ğŸŒ
}

---
// promise API ì‚¬ìš©
function pickAllFruits(){
  return Promise.all([getApple(), getBanana()])
  // promise ë°°ì—´ì„ ì „ë‹¬í•˜ê²Œë˜ë©´ ëª¨ë“  promiseê°€ ë³‘ë ¬ì ìœ¼ë¡œ ë‹¤ ë°›ì„ë•Œê¹Œì§€ ëª¨ì•„ì¤Œ 
  .then(fruits => fruits.join(' + '))
}
pickAllFruits().then(console.log) // 3ì´ˆ í›„ì— ğŸ + ğŸŒ

---
async function getBanana(){
  await delay(1000);
  return 'ğŸŒ';
}

function pickOnlyOne(){
  return Promise.race([getApple(), getBanana()])
  // ë°°ì—´ì— ì „ë‹¬ëœ promise ì¤‘ì—ì„œ ê°€ì¥ ë¨¼ì € ê°’ì„ ë¦¬í„´í•˜ëŠ” ì•„ì´ë§Œ ì „ë‹¬
}
pickOnlyOne().then(console.log); ğŸŒ
```
###Error Handling
```js
async function myAsyncFun(){
    throw 'myAsyncError!'
}
const result = myAsyncFun()// Uncaught (in promise) myAsyncError!
console.log(result) // Promise {<rejected>: "myAsyncError!"}

// promiseìƒì„±í•˜ëŠ” ë‹¨ê³„ì—ì„œ rejectë¡œ ì˜ˆì™¸ ë°œìƒ
// async í•¨ìˆ˜ì—ì„œëŠ” ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì—ì„œ ì˜ˆì™¸ë¥¼ ë°œìƒí•˜ëŠ” ë°©ë²•ê³¼ ë™ì¼í•˜ê²Œ throw
// ê·¸ë ‡ê¸° ë•Œë¬¸ì— catch ë¡œ ì¡ì•„ì•¼ ë¨

const result = myAsyncFun().catch(e => {
  console.error(e);
}) // 'myAsyncError!'

---
function wait(sec){
  return new Promise((resolve) => {
    setTimeout(() => {
      // resolve('done');
      reject('wait Error')
    }, sec * 1000);
  });
}
asnyc function myAsyncFun() {
  console.log(new Date());
  await wait(3).catch(e ==> {
    console.error(e); // wait Error
  });
  // try{
  //   await wait(3)
  // } catch(e){
  //   console.error(e)
  // } ìœ„ë‘ ê°™ìŒ 
  console.log(result) // undefinedê°€ ë¨ ê·¸ ì´ìœ ëŠ” awaitì´ ê¸°ë‹¤ë¦¬ëŠ” promiseëŠ” 
  // wait(3)ì¸ new promiseë¥¼ í†µí•´ì„œ ë¦¬í„´ëœ ê²ƒì´ ì•„ë‹ˆë¼ catchë¥¼ í†µí•´ì„œ ë¦¬í„´ëœ promiseë¥¼ await
  // promiseê°€ ì •ìƒì ìœ¼ë¡œ ëì„ ë•Œ, catchëŠ” ì•ì—ì„œ ë„˜ê²¨ì¤€ resolve ê°’ì„ ê·¸ëŒ€ë¡œ resolve
  // ì˜ˆì™¸ë¥¼ ë°œìƒí•´ì„œ catchë¡œ ì™”ëŠ”ë°, catchëŠ” ì–´ë–¤ ê°’ë„ ë¦¬í„´í•˜ì§€ ì•Šì•˜ìŒ ê·¸ë˜ì„œ undefined
  console.log(new Date());
}
const result = myAsyncFun();

---
// ë§Œì•½ì— asyncê³¼ awaitì—ì„œ ìš°ë¦¬ê°€ ì˜ë„í•˜ì§€ ì•Šê²Œ ë°œìƒì‹œí‚¨ ë¬¸ë²•ì´ë‚˜ ì˜¤íƒ€ê°™ì€ ê²½ìš°
// uncaught refernce errorê°€ ìƒê¹€ 
// ì´ê²ƒì„ ì²˜ë¦¬í•˜ë ¤ë©´ 
// myAsyncFun().catch((e) => console.log(e))// uncaughtëŠ” ë¹¼ê³  error ë¶€ë¶„ë§Œ ë‚˜ì˜´
```
####reference:
- https://www.youtube.com/channel/UC_4u-bXaba7yrRz_6x6kb_w
- https://www.youtube.com/channel/UC9hWQRe4QrUivXN3VO2iuMA